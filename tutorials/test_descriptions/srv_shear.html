
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DESCQA-SRV shear &#8212; SRV DP0.2 Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/test_descriptions/srv_shear';</script>
    <link rel="canonical" href="https://lsstdesc.github.io/srv-dp02/tutorials/test_descriptions/srv_shear.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="DESCQA-SRV stars" href="srv_stars.html" />
    <link rel="prev" title="DESCQA-SRV photometry errors" href="srv_photometry_errors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="SRV DP0.2 Tutorials - Home"/>
    <img src="../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="SRV DP0.2 Tutorials - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    SRV Tutorials
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials (Rubin data)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Rubin/DP02_intro.html">DP0.2 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rubin/tutorial1_reading_objects.html">GCR access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rubin/tutorial2_alternate_reads.html">Beyond-GCR access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rubin/tutorial3_Rubin_analysistools.html">Using Rubin analysis tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rubin/tutorial4_using_DESCQA.html">Running DESCQA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rubin/tutorial7_SRV_releases.html">SRV releases</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Plans for data arrival</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../plans/data.html">Plans for data provision</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Validation test descriptions</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="srv_gaap.html">DESCQA-SRV gaap</a></li>
<li class="toctree-l1"><a class="reference internal" href="srv_photometry_errors.html">DESCQA-SRV photometry errors</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">DESCQA-SRV shear</a></li>
<li class="toctree-l1"><a class="reference internal" href="srv_stars.html">DESCQA-SRV stars</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../advanced/tutorial8_DMStack_NERSC.html">Running SSI using Rubin pipelines (move this)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/LSSTDESC/srv-dp02/issues/new?title=Issue%20on%20page%20%2Ftutorials/test_descriptions/srv_shear.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/tutorials/test_descriptions/srv_shear.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>DESCQA-SRV shear</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#star-selection-for-psfs">Star selection for PSFs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-residuals">PSF residuals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rubin-testing">Rubin testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrated-exposures-calexps">Calibrated exposures (calexps)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#object-catalog-measured-from-coadds">Object Catalog (measured from coadds)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-test">The test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">PSF residuals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rowe-statistics">Rowe statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-improve-on-this">How do we improve on this?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="descqa-srv-shear">
<h1>DESCQA-SRV shear<a class="headerlink" href="#descqa-srv-shear" title="Link to this heading">#</a></h1>
<p>Owners: <strong>PatriciaLarsen <a class="reference external" href="https://github.com/LSSTDESC/DC2-analysis/issues/new?body=&#64;patricialarsen">&#64;plarsen</a></strong><br />
Last Verifed to Run: <strong>2024-06-04</strong> (by &#64;plarsen)</p>
<p>This notebook details the DESCQA-SRV shear test. This test covers shear and PSF-related checks, and can be run on the command line for the full dp0.2 catalog using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>./run_master.sh<span class="w"> </span>-t<span class="w"> </span>srv_shear<span class="w"> </span>-c<span class="w"> </span>dp02
</pre></div>
</div>
<p>The PSFs in LSST data releases are expected to be computed from the PIFF code. This measures the point spread function from stars in individual visits, and then combines and interpolates them to form a PSF map over the sky. Our SRV-level testing is unlikely to go into more detail than that of the commissioning team, but hopefully it will be useful to help the wider DESC understand the achieved level of data quality and further investigate how any limitations could impact your science.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;/global/cfs/projectdirs/lsst/groups/SRV/gcr-catalogs-test&#39;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">GCRCatalogs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span> 


<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">catalog</span> <span class="o">=</span> <span class="n">GCRCatalogs</span><span class="o">.</span><span class="n">load_catalog</span><span class="p">(</span><span class="s1">&#39;lsst_object&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="star-selection-for-psfs">
<h2>Star selection for PSFs<a class="headerlink" href="#star-selection-for-psfs" title="Link to this heading">#</a></h2>
<p>Star-galaxy separation and the quality of the psf_candidate sample are addressed in the srv_stars test. Star galaxy separations are typically performed using the extendedness parameter, and then magnitude, color-based or signal to noise cuts can be used to refine stellar samples to reduce galaxy contamination. Stars used for psf determination are labeled by the calib_psf_used flag, those reserved for testing are labeled by the calib_psf_reserved flag, and all candidate stars are labeled by the calib_psf_candidate flag. For more details please see the srv_stars notebook.</p>
</section>
<section id="psf-residuals">
<h2>PSF residuals<a class="headerlink" href="#psf-residuals" title="Link to this heading">#</a></h2>
<p>To quantify the accuracy of the PSFs, we look at the measurements of the stars reserved from the PSF sample and compare them to the expected PSF values. These residuals form a good test of the PSF accuracy.</p>
<p>This is typically done in a few ways</p>
<ul class="simple">
<li><p>look at the size and ellipticity residuals as a function of the focal plane</p></li>
<li><p>look at the size and ellipticity residuals as a function of their color and magnitude</p></li>
<li><p>look at the rho/Rowe statistics, the correlations of the size and ellipticity residuals expected to contaminate lensing studies</p></li>
</ul>
<p>*Note: If anyone can tell me if the true name of these statistics is rho statistics or Rowe statistics I’d be very grateful!</p>
</section>
<section id="rubin-testing">
<h2>Rubin testing<a class="headerlink" href="#rubin-testing" title="Link to this heading">#</a></h2>
<p>The Rubin Observatory LSST project runs a number of tests, here I’m summarising based on <a class="reference external" href="https://sitcomtn-124.lsst.io/#visit-level-metrics">operations rehearsal 3</a>, but you can see what is typically run in the yaml file <a class="reference external" href="https://github.com/lsst/analysis_tools/blob/main/pipelines/visitQualityCore.yaml">here</a>. This overlaps substantially with the list in srv_stars.</p>
<section id="calibrated-exposures-calexps">
<h3>Calibrated exposures (calexps)<a class="headerlink" href="#calibrated-exposures-calexps" title="Link to this heading">#</a></h3>
<p>These are typically looking at the differences between the point spread function ellipticity and size with the true point spread function measured at the star position.</p>
<ul class="simple">
<li><p>psfStarDeltaE1/E2 Median and Scatter</p></li>
<li><p>psfStarDeltaSize Median and Scatter</p></li>
<li><p>psfStarScaledDeltaSizeScatter</p></li>
</ul>
</section>
<section id="object-catalog-measured-from-coadds">
<h3>Object Catalog (measured from coadds)<a class="headerlink" href="#object-catalog-measured-from-coadds" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>e1/2Diff: Statistics of residual of e1 ellipticity measurement of sources relative to the PSF (high and low S/N)</p></li>
<li><p>shapeSizeFractionalDiff: Fractional size residuals relative to PSF (high and low S/N)</p></li>
</ul>
<p>There are also tests that are not within the core quality checks but are highly relevant to PSF accuracy, such as the <a class="reference external" href="https://pipelines.lsst.io/v/daily/py-api/lsst.analysis.tools.actions.vector.CalcRhoStatistics.html#lsst.analysis.tools.actions.vector.CalcRhoStatistics">rho statisics test</a>.</p>
</section>
</section>
<section id="the-test">
<h2>The test<a class="headerlink" href="#the-test" title="Link to this heading">#</a></h2>
<p>As always, we get started by reading the data! We require the shape measurements to get the size and ellipticities of the stars and PSFs, the reserve star masks to get the points at which to test, and the magnitudes to quantify magnitude-dependent errors. We filter out objects using detect_isPrimary, as well as bad psfFlux values, extendedness values, and shape values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read necessary quantities </span>
<span class="c1">#For stars you typically want to use the PSFflux quantities. </span>

<span class="n">quantities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;coord_ra&quot;</span><span class="p">,</span><span class="s2">&quot;coord_dec&quot;</span><span class="p">]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_psfFlux&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_psfFluxErr&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_calib_psf_candidate&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_calib_psf_used&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_calib_psf_reserved&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_extendedness&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixx&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixy&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyy&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixxPSF&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixyPSF&quot;</span><span class="p">)</span>
    <span class="n">quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyyPSF&quot;</span><span class="p">)</span>
    
<span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;detect_isPrimary&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_psfFlux_flag==False&quot;</span><span class="p">)</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_extendedness_flag==False&quot;</span><span class="p">)</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_i_flag==False&quot;</span><span class="p">)</span>
    <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iPSF_flag==False&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_quantities</span><span class="p">(</span><span class="n">quantities</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>  

<span class="n">ra</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coord_ra&#39;</span><span class="p">]</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;coord_dec&#39;</span><span class="p">]</span>

<span class="c1"># multiple possible definitions of this size, LSST tends to use np.sqrt((data[&#39;r_ixx&#39;]+data[&#39;r_iyy&#39;])/2.)</span>
<span class="n">size</span><span class="o">=</span><span class="p">{}</span>
<span class="n">size_PSF</span><span class="o">=</span><span class="p">{}</span>
<span class="n">e_12</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">e_12_PSF</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">mags</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
    <span class="n">size</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixx&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyy&quot;</span><span class="p">]</span>
    <span class="n">size_PSF</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixxPSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyyPSF&quot;</span><span class="p">]</span>
    <span class="n">e_12</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixx&quot;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixy&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyy&quot;</span><span class="p">])</span>
    <span class="n">e_12_PSF</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixxPSF&quot;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_ixyPSF&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_iyyPSF&quot;</span><span class="p">])</span>
    <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_nanoJansky_to_mag</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s2">&quot;_psfFlux&quot;</span><span class="p">])</span>
    
<span class="c1">#we&#39;re going to use r,g,i bands to define our samples</span>
<span class="n">mask_stars</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;i_extendedness&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_extendedness&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_extendedness&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mask_candidates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_calib_psf_candidate&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;i_calib_psf_candidate&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_calib_psf_candidate&#39;</span><span class="p">]</span>
<span class="n">mask_used</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_calib_psf_used&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;i_calib_psf_used&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_calib_psf_used&#39;</span><span class="p">]</span>
<span class="n">mask_reserve</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;g_calib_psf_reserved&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;i_calib_psf_reserved&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;r_calib_psf_reserved&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/global/u2/p/plarsen/plarsen_git/srv-dp02/tutorials/test_descriptions/utils.py:10: RuntimeWarning: invalid value encountered in log10
  return -2.5 * np.log10(flux) + AB_mag_zp_wrt_nanoJansky
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h2>PSF residuals<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>We start by plotting the PSF residuals across the sky (remember we’re only using a test tract here so it’ll look a little funky).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vals</span><span class="p">,</span> <span class="n">bins1</span><span class="p">,</span><span class="n">bins2</span><span class="p">,</span><span class="n">counts</span><span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic_2d</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span> <span class="n">size_PSF</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">vals2</span><span class="p">,</span> <span class="n">bins1</span><span class="p">,</span><span class="n">bins2</span><span class="p">,</span><span class="n">counts</span><span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic_2d</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span><span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">/</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">],</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">vals3</span><span class="p">,</span> <span class="n">bins1</span><span class="p">,</span><span class="n">bins2</span><span class="p">,</span><span class="n">counts</span><span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic_2d</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span><span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">vals4</span><span class="p">,</span> <span class="n">bins1</span><span class="p">,</span><span class="n">bins2</span><span class="p">,</span><span class="n">counts</span><span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic_2d</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span><span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">bins1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA (degrees)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;declination (degrees)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;average PSF size&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vals2</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">bins1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA (degrees)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PSF size residual&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vals3</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">bins1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="c1">#axs[2].set_xlabel(&#39;RA (degrees)&#39;)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PSF e1 residual&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">im4</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">vals4</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">bins1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="c1">#axs[0].set_xlabel(&#39;RA (degrees)&#39;)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PSF e2 residual&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/757f53dd442621ba6ffa503e45e5d75c0ede0b5f8b968785fc6a950441c62a8d.png" src="../../_images/757f53dd442621ba6ffa503e45e5d75c0ede0b5f8b968785fc6a950441c62a8d.png" />
</div>
</div>
<p>Looking at the above plot of the average PSF size we can see variation over the sky. The size residual will exhibit patterns on the focal plane of the detector, but these are less visible in sky co-ordinates. There will also be atmospheric effects which make visible patterns. It’s these residuals though that if correlated will impact measurements.</p>
<p>Certain effects can be seen in the average residual as a function of magnitude or in color samples. These include brighter-fatter effects or chromatic refraction effects. So let’s next plot these as a function of magnitude. We add color bins below for chromatic checks, from Jarvis et. al (add year, DES Y3 PSFs), but with this tract we simply don’t have enough stars to do this color cut so we’ll hold off on applying that test.</p>
<p>*Note to self: would be good to expand on this</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cbin1</span> <span class="o">=</span> <span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">2</span> <span class="p">)</span><span class="o">&amp;</span><span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="mf">1.85</span><span class="p">)</span>
<span class="n">cbin2</span> <span class="o">=</span> <span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">1</span> <span class="p">)</span><span class="o">&amp;</span><span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">cbin3</span> <span class="o">=</span> <span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.05</span> <span class="p">)</span><span class="o">&amp;</span><span class="p">((</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">&gt;=-</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">vals</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">],(</span><span class="n">size</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">/</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">vals_e1</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">],(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">vals_e2</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">],(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">m_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>


<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_bin</span><span class="p">,</span><span class="n">vals</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bin</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m_bin</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag_r&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;size residual&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_bin</span><span class="p">,</span><span class="n">vals_e1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;e1&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m_bin</span><span class="p">,</span><span class="n">vals_e2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;e2&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bin</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m_bin</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag_r&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ellipticity residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eec5614093a417f215243bf22076c684b9e8ad18165de808b03fd6ee0ec3137c.png" src="../../_images/eec5614093a417f215243bf22076c684b9e8ad18165de808b03fd6ee0ec3137c.png" />
</div>
</div>
<p>We’re seeing no significant residuals in the ellipticities! There is a pretty clear magnitude dependence in the overall size, which may indicate residual brighter-fatter issues.</p>
</section>
<section id="rowe-statistics">
<h2>Rowe statistics<a class="headerlink" href="#rowe-statistics" title="Link to this heading">#</a></h2>
<p>Now we understand a little better what the data actually looks like, let’s think about how it’ll impact our science. To quantify the actual impact of these PSF residuals on the two-point correlation functions we look at their correlations through the Rowe statistics. The first of these was developed by Rowe 2010, and the remaining 4 were developed in Jarvis et al 2016.</p>
<p>Non-zero Rowe statistics indicate systematics in the PSF statistics, these have prefactors of order unity so the plots below should show roughly the level of effect on weak lensing autocorrelations.</p>
<p>*Add equations here</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">treecorr</span>
<span class="n">treecorr_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;min_sep&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;max_sep&quot;</span><span class="p">:</span> <span class="mf">250.0</span><span class="p">,</span>
            <span class="s2">&quot;nbins&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s2">&quot;bin_slop&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="s2">&quot;sep_units&quot;</span><span class="p">:</span> <span class="s2">&quot;arcmin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;psf_size_units&quot;</span><span class="p">:</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_rowe</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing Rowe statistic rho_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> objects&quot;</span><span class="p">)</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">GGCorrelation</span><span class="p">(</span><span class="n">treecorr_config</span><span class="p">)</span>
    <span class="n">cat1</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dec</span><span class="p">),</span> <span class="n">g1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">g2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">ra_units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span> <span class="n">dec_units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
    <span class="n">cat2</span> <span class="o">=</span> <span class="n">treecorr</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="n">dec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dec</span><span class="p">),</span> <span class="n">g1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">g2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">q2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">ra_units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span> <span class="n">dec_units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
    <span class="n">corr</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">cat1</span><span class="p">,</span> <span class="n">cat2</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">corr</span><span class="o">.</span><span class="n">meanr</span><span class="p">,</span> <span class="n">corr</span><span class="o">.</span><span class="n">xip</span><span class="p">,</span> <span class="n">corr</span><span class="o">.</span><span class="n">varxip</span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">de1</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">real</span>
<span class="n">de2</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">e_12_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">.</span><span class="n">imag</span>
<span class="n">e1</span> <span class="o">=</span> <span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">e_12</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
<span class="n">T_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span><span class="o">-</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">])</span><span class="o">/</span><span class="n">size_PSF</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">mask_reserve</span><span class="p">]</span>

<span class="n">meanr1</span><span class="p">,</span> <span class="n">xip1</span><span class="p">,</span> <span class="n">stdxip1</span> <span class="o">=</span> <span class="n">compute_rowe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">de1</span><span class="p">,</span><span class="n">de2</span><span class="p">),</span> <span class="p">(</span><span class="n">de1</span><span class="p">,</span><span class="n">de2</span><span class="p">))</span>
<span class="n">meanr2</span><span class="p">,</span> <span class="n">xip2</span><span class="p">,</span> <span class="n">stdxip2</span> <span class="o">=</span> <span class="n">compute_rowe</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">),</span> <span class="p">(</span><span class="n">de1</span><span class="p">,</span><span class="n">de2</span><span class="p">))</span>
<span class="n">meanr3</span><span class="p">,</span> <span class="n">xip3</span><span class="p">,</span> <span class="n">stdxip3</span> <span class="o">=</span> <span class="n">compute_rowe</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span><span class="o">*</span><span class="n">T_f</span><span class="p">,</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span><span class="o">*</span><span class="n">T_f</span><span class="p">)</span>
<span class="n">meanr4</span><span class="p">,</span> <span class="n">xip4</span><span class="p">,</span> <span class="n">stdxip4</span> <span class="o">=</span> <span class="n">compute_rowe</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">de1</span><span class="p">,</span><span class="n">de2</span><span class="p">),</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span><span class="o">*</span><span class="n">T_f</span><span class="p">)</span>
<span class="n">meanr5</span><span class="p">,</span> <span class="n">xip5</span><span class="p">,</span> <span class="n">stdxip5</span> <span class="o">=</span> <span class="n">compute_rowe</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">ra</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="n">mask_reserve</span><span class="p">],</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">),</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span><span class="o">*</span><span class="n">T_f</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meanr1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xip1</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Rowe 1&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meanr3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xip3</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Rowe 3&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meanr4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xip4</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Rowe 4&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;arcmin&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meanr2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xip2</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Rowe 2&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">meanr5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xip5</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Rowe 5&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;arcmin&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing Rowe statistic rho_1 from 196 objects
Computing Rowe statistic rho_2 from 196 objects
Computing Rowe statistic rho_3 from 196 objects
Computing Rowe statistic rho_4 from 196 objects
Computing Rowe statistic rho_5 from 196 objects
</pre></div>
</div>
<img alt="../../_images/0adb446597abcbe1890dec1cf181383dea1aa450371cfc90c7b153764f3bade1.png" src="../../_images/0adb446597abcbe1890dec1cf181383dea1aa450371cfc90c7b153764f3bade1.png" />
</div>
</div>
</section>
<section id="how-do-we-improve-on-this">
<h2>How do we improve on this?<a class="headerlink" href="#how-do-we-improve-on-this" title="Link to this heading">#</a></h2>
<p>As the PSFs are computed ahead of the coadds and is in some way independent of the galaxy sample, it’s difficult to create exclusions that would improve these. However, we can look for areas in the map to exclude if they have a strong residual signal, or for issues in specific bands to motivate exclusion from shear studies. In the long term, issues in the results can motivate iterations to the star-galaxy separation, or development of the PIFF code to make improvements. If you’d like to contribute to these studies please get in touch with the pixels-to-objects working group for ways to get involved.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "desc-python",
            path: "./tutorials/test_descriptions"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'desc-python'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="srv_photometry_errors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">DESCQA-SRV photometry errors</p>
      </div>
    </a>
    <a class="right-next"
       href="srv_stars.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">DESCQA-SRV stars</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#star-selection-for-psfs">Star selection for PSFs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-residuals">PSF residuals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rubin-testing">Rubin testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibrated-exposures-calexps">Calibrated exposures (calexps)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#object-catalog-measured-from-coadds">Object Catalog (measured from coadds)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-test">The test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">PSF residuals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rowe-statistics">Rowe statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-improve-on-this">How do we improve on this?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By LSST DESC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>